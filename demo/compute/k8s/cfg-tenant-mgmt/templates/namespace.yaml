{{- range $name, $tenant := .Values.tenants }}
apiVersion: v1
kind: Namespace
metadata:
  name: {{ $name }}
  labels:
    platform.it.vt.edu/purpose: platform-tenant
    {{- if $tenant.monitoringNamespace }}
    platform.it.vt.edu/monitoringNamespace: {{ $tenant.monitoringNamespace }}
    {{- end }}
    {{- if $tenant.nodePool }}
    platform.it.vt.edu/node-pool: {{ $tenant.nodePool }}
    {{- end }}
    {{- if $tenant.labels }}
    {{- $tenantLabels := $tenant.labels }}
    {{ .Values.tenantLabels | toYaml | indent 4}}
    {{- end }}{{/* end $tenant.labels */}}
  annotations:
  {{- if $tenant.annotations }}
{{ $tenant.annotations | toYaml | indent 4 }}
    {{- end }}{{/* end $tenant.annotations */}}
  {{- if $tenant.contacts }}
    {{- range $i, $val := $tenant.contacts }}
    platform.it.vt.edu/tenant-contact-{{ $i }}: {{ printf "[%s] %s<%s>" $val.type $val.name $val.email | quote }}
    {{- end }} {{/* end single contact */}}
  {{- end }} {{/* end $tenant.contacts annotation */}}
  {{- if $tenant.data }}
    platform.it.vt.edu/data-classification: {{ $tenant.data.classification | default "low-risk" }}
    platform.it.vt.edu/data-kinds: {{ join "," $tenant.data.dataKinds | default "none" }}
    platform.it.vt.edu/data-description: {{ $tenant.data.description | quote | default "unknown" }}
  {{- end }} {{/* end $tenant.data annotation */}}
  {{- if $tenant.criticality }}
    platform.it.vt.edu/tenant-critical-to: {{ $tenant.criticality.criticalTo | default "none" }}
    platform.it.vt.edu/tenant-critical-description: {{ $tenant.criticality.description | quote | default "none" }}
  {{- end }} {{/* $tenant.criticality annotation */}}
---
{{- end }} {{/* range tenants */}}